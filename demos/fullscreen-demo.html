<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

  <title>Fullscreen Demo</title>
  
  <style type="text/css" media="screen">
  
    html, body {
      background: #000;
      margin: 0;
      padding: 0;
    }
      
      #shell {
        color: #ccc;
        text-align: center;
        width: 100%;
      }
      
        #shell img {
          width: 100%;
        }
    
  </style>
  
  <script src="http://ajax.googleapis.com/ajax/libs/prototype/1.6.0.3/prototype.js" type="text/javascript"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/scriptaculous/1.8.2/effects.js" type="text/javascript"></script>
  
  <script type="text/javascript" charset="utf-8">
    
    var images = [
      'http://farm4.static.flickr.com/3051/3010450921_1b9abd5810_o.jpg',
      'http://farm4.static.flickr.com/3227/2786547077_8d0f2db32e_o.jpg',
      'http://farm4.static.flickr.com/3107/2680342845_a62668b4d6_o.gif'
    ];
    
    var DeferredLoader = Class.create({
      
      initialize: function(loader, options){
        
        this.loader = $(loader);
        this.defaultOptions = $H({
          imagePaths: []
        });
        this.count = 0;

        // assigning the options to internal variables
        this.defaultOptions.merge(options).each(function(option){
          this[option[0]] = option[1];
        }.bind(this));
        
        // create an array to store which images have been loaded
        this.loadedImages = new Array(this.imagePaths.length);
        for (var i=0; i < this.loadedImages.length; i++) {
          this.loadedImages[i] = false;
        };
        
        if (!this.loader || this.imagePaths.length == 0) return;
        
        this.go();
        
      },
      
      go: function(){
        this.loader.update('');
        this.insertImage();
      },
      
      insertImage: function(){
        if (this.count >= this.imagePaths.length) return;
        this.loader.insert(
          new Element('img', { src: this.imagePaths[this.count], style: 'display: none; opacity: 0;' })
        );
        this.loader.select('img').last().observe('load', this.imageLoaded.bind(this));
      },
      
      imageLoaded: function(e){
        console.log('imageLoaded: ' + this.count);
        if (this.count == 0){
          for (var i=1; i < this.imagePaths.length; i++) {
            this.insertImage();
            this.updateInternalObjects();
          };
        }
        e.element().appear();
      },
      
      updateInternalObjects: function(){
        this.loadedImages[this.count] = true;
        this.count++;
      }
      
    });
    
    document.observe('dom:loaded', function(){
      var myDeferredLoader = new DeferredLoader('shell', { imagePaths: images });
    });
    
  </script>
  
</head>

<body>

  <div id="shell">Loading</div>

</body>
</html>
